{% extends 'common/master.html' %}
{% load static %}
{% block content %}

<head>
    <link rel="stylesheet" href="{% static 'css/content.css' %}">
    <link rel="stylesheet" href="{% static 'css/studentStats.css' %}">
</head>

{% include "common/header.html" %}
<div class="col-10 col-sm-4 col-md-3 col-lg-2 float-left left">
    {% include "home/leftside.html" %}
</div>

<div class="content">
    <div class="container-fluid">
        <div class="row first mb-5 mt-3">
            <div class="col-3 col-sm-3 col-md-2 col-lg-1">
                <div class="col-12">
                    <a href="{% url 'homework:homeworkDetails' homework.id %}"><button class="btn back" title="Back"><i
                                class="fas fa-arrow-alt-circle-left"></i></button></a>
                </div>
            </div>
            <div class="col-9 col-sm-9 col-md-6 col-lg-7 subject-name">
                {{homework.Name}}
            </div>
        </div>
        <button class="btn btn-primary btn-sm" id="btnExpo"> EXPORT </button>
        <div class="row float-right text-secondary font-weight-bold mr-3 border mb-1">
            <span class="badge badge-light pl-5 pr-5 pt-2 lead">Assets:</span>
            <span class="border-right border-secondary pl-1 pr-1"> Number of pdfs: {{Pdf}}</span>
            <span class="border-right border-secondary pl-1 pr-1">Number of videos: {{Video}}</span>
            <span class="border-right border-secondary pl-1 pr-1">Total : {{Total}} </span>
        </div>
        <div class="table-responsive contain">
            <table class="table table-hover table-sm table-borderless text-center" id="stats">
                <thead class="thead">
                    <tr>
                        <th>S.No.</th>
                        <th>Name</th>
                        <th>Videos Completed</th>
                        <th>Videos Completed %</th>
                        <th>PDFs Completed</th>
                        <th>PDFs Completed %</th>
                        <th>Total Completed</th>
                        <th>Total Completed %</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for key in students %}
                    <tr class="tr">
                        <td>{{forloop.counter}}</td>
                        <td>{{key.Name}}</td>
                        <td>{{key.Completed_videos}}</td>
                        <td>{% widthratio key.Completed_videos Video 1 %}</td>
                        <td>{{key.Completed_pdfs}}</td>
                        <td>{% widthratio key.Completed_pdfs Pdf 1 %}</td>
                        <td>{{key.Total}}</td>
                        <td>{{key.percentage}}%</td>
                        <td class="{% if key.percentage  == 100 %}done{% else %}pending{% endif %}"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div style="max-width: 200px; max-height: 200px;">
            <canvas id="myChart" width="200px" height="200px"></canvas>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="{% static 'js/htmltoexcel.js' %}"></script>
<script>
    $('#btnExpo').click(function () {
        $('#stats').table2excel({
            name: "Lesson Stats",
            filename: "students.xls", // do include extension
            preserveColors: true // set to true if you want background colors and font colors preserved
        });
    })

    var ctx = document.getElementById('myChart').getContext('2d');
    let labels = []; {% for label in labels %} labels.push('{{ label }}'){% endfor %}
    let data = []; {% for dat in data %} data.push('{{ dat }}'){% endfor %}
    var myChart = new Chart(ctx, {
        type: 'horizontalBar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Percentage',
                data: data,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1,
                barThickness: 10,
                maxBarThickness: 15,
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    ticks: {
                        beginAtZero: true,
                        suggestedMax: 100
                    }
                }]
            }
        }
    });
</script>

{% endblock %}